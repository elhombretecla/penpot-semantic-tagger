penpot.ui.open("Semantic Tagging",`?theme=${penpot.theme}`,{width:320,height:600});let p=new Map;function l(){r(),i()}function r(){try{p.clear(),penpot.ui.sendMessage({source:"penpot",type:"tags-loaded",data:Array.from(p.values())})}catch(e){console.warn("Error loading existing tags:",e)}}function g(){try{console.log("Tags saved in memory:",p.size)}catch(e){console.error("Error saving tags:",e)}}function i(){const n=penpot.selection.map(a=>({id:a.id,name:a.name||"Unnamed",type:a.type}));penpot.ui.sendMessage({source:"penpot",type:"selection-update",data:n})}function d(e,n,a){a.forEach(o=>{var s;const t=(s=penpot.currentPage)==null?void 0:s.getShapeById(o);if(t){const c={tag:e,properties:n,elementId:o,elementName:t.name||"Unnamed"};p.set(o,c),penpot.ui.sendMessage({source:"penpot",type:"tag-applied",data:c})}}),g()}function u(e){e.forEach(n=>{var o;((o=penpot.currentPage)==null?void 0:o.getShapeById(n))&&(p.delete(n),penpot.ui.sendMessage({source:"penpot",type:"tag-removed",data:{elementId:n}}))}),g()}function h(){var a;const e=Array.from(p.values()),n={metadata:{pluginName:"Semantic Tagging Plugin",version:"1.0.0",exportDate:new Date().toISOString(),fileName:((a=penpot.currentFile)==null?void 0:a.name)||"Untitled",totalElements:e.length},elements:e.map(o=>{var s;const t=(s=penpot.currentPage)==null?void 0:s.getShapeById(o.elementId);return{...o,elementType:(t==null?void 0:t.type)||"unknown",position:t?{x:t.x,y:t.y}:null,size:t?{width:t.width,height:t.height}:null}})};penpot.ui.sendMessage({source:"penpot",type:"export-data",data:n})}penpot.ui.onMessage(e=>{switch(e.type){case"get-selection":i();break;case"apply-tag":e.data&&d(e.data.tag,e.data.properties,e.data.elementIds);break;case"remove-tag":e.data&&u(e.data.elementIds);break;case"export-tags":h();break;default:console.warn("Unrecognized message:",e.type)}});penpot.on("selectionchange",()=>{i()});penpot.on("themechange",e=>{penpot.ui.sendMessage({source:"penpot",type:"themechange",theme:e})});penpot.on("pagechange",()=>{r(),i()});penpot.on("filechange",()=>{p.clear(),r(),i()});l();
