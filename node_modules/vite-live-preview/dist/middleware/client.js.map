{"version":3,"file":"client.js","sources":["../../src/middleware/client.ts"],"sourcesContent":["import path from 'node:path';\n\nimport { type Connect } from 'vite';\n\nimport TEMPLATE_CLIENT_SCRIPT from '../template/client.js?raw';\nimport { createDebugger } from '../util/create-debugger.js';\n\ninterface Options {\n  readonly base: string;\n}\n\nexport const CLIENT_SCRIPT_NAME = 'vite-live-preview/client.ts';\n\n/**\n * Middleware that serves the client script.\n */\nexport default ({ base }: Options): Connect.NextHandleFunction => {\n  const debug = createDebugger('live-preview');\n  const script = TEMPLATE_CLIENT_SCRIPT.replace(/(?<=const base *= *)'\\/'/u, JSON.stringify(base));\n  const length = Buffer.byteLength(script, 'utf8');\n  const route = path.posix.join(base, CLIENT_SCRIPT_NAME);\n\n  return (req, res, next) => {\n    if (req.url !== route) return next();\n\n    res.setHeader('Content-Type', 'text/javascript');\n    res.setHeader('Content-Length', length);\n    res.end(script);\n    debug?.('served client script.');\n  };\n};\n"],"names":[],"mappings":";;;;AAWO,MAAM,kBAAqB,GAAA,8BAAA;AAKlC,yBAAe,CAAC,EAAE,IAAA,EAAgD,KAAA;AAChE,EAAM,MAAA,KAAA,GAAQ,eAAe,cAAc,CAAA,CAAA;AAC3C,EAAA,MAAM,SAAS,sBAAuB,CAAA,OAAA,CAAQ,6BAA6B,IAAK,CAAA,SAAA,CAAU,IAAI,CAAC,CAAA,CAAA;AAC/F,EAAA,MAAM,MAAS,GAAA,MAAA,CAAO,UAAW,CAAA,MAAA,EAAQ,MAAM,CAAA,CAAA;AAC/C,EAAA,MAAM,KAAQ,GAAA,IAAA,CAAK,KAAM,CAAA,IAAA,CAAK,MAAM,kBAAkB,CAAA,CAAA;AAEtD,EAAO,OAAA,CAAC,GAAK,EAAA,GAAA,EAAK,IAAS,KAAA;AACzB,IAAA,IAAI,IAAI,GAAQ,KAAA,KAAA;AAAO,MAAA,OAAO,IAAK,EAAA,CAAA;AAEnC,IAAI,GAAA,CAAA,SAAA,CAAU,gBAAgB,iBAAiB,CAAA,CAAA;AAC/C,IAAI,GAAA,CAAA,SAAA,CAAU,kBAAkB,MAAM,CAAA,CAAA;AACtC,IAAA,GAAA,CAAI,IAAI,MAAM,CAAA,CAAA;AACd,IAAA,KAAA,GAAQ,uBAAuB,CAAA,CAAA;AAAA,GACjC,CAAA;AACF,CAAA;;;;"}